<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœˆé¤…è±ç››ä¹‹æ—… (Mooncake Rich Journey) - æœ€çµ‚ç‰ˆ (å¤§åœ°è‰²ç³»)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        /* å¤§åœ°è‰²ç³»é¢¨æ ¼ CSS */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f7f9fc; }
        .header-curve { position: relative; z-index: 10; }
        
        /* èª¿æ•´å¡ç‰‡æ¨£å¼ä»¥é©æ‡‰å¤§åœ°è‰²ç³» */
        .light-card { 
            border-radius: 1rem; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            transition: transform 0.2s; 
            border: 1px solid #e2e8f0; 
            background-color: #fff8f0; /* ç±³ç™½è‰²å¡ç‰‡èƒŒæ™¯ */
        }
        .light-card:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1); }
        
        /* å°èˆªæŒ‰éˆ•æ¨£å¼èª¿æ•´ (æ–°ä¸»è‰²: å’–å•¡è‰² #9f583f) */
        .tab-icon.active { 
            color: #9f583f; 
            background-color: #fae9d4; /* æ·ºé»ƒè‰²èƒŒæ™¯ */
            border-radius: 9999px; 
        }
        .modal-overlay { background-color: rgba(0, 0, 0, 0.4); }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen bg-[#fff8f0] text-gray-800">
        <header class="header-curve relative h-[250px] overflow-hidden bg-[#fae9d4]">
            <div class="h-full bg-cover bg-center" style="background-image: url('./banner.jpg'); background-color: #d7a387;">
                <div class="flex items-center justify-center h-full backdrop-brightness-90">
                    <div class="text-center">
                        <h1 class="text-4xl font-extrabold text-white text-shadow-lg tracking-wider">æœˆé¤…è±ç››ä¹‹æ—…</h1>
                        <p class="text-sm text-[#9f583f] mt-1">Mooncake Rich Journey - æ”¶å…¥è¿½è¹¤</p>
                    </div>
                </div>
            </div>

            <nav class="absolute bottom-[20px] right-4 z-20 flex space-x-1 rounded-full bg-white p-1.5 shadow-xl">
                <button @click="activeTab = 'Dashboard'" :class="{'active': activeTab === 'Dashboard'}" class="tab-icon p-2 text-2xl text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" /><path stroke-linecap="round" stroke-linejoin="round" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" /></svg>
                </button>
                <button @click="activeTab = 'Items'" :class="{'active': activeTab === 'Items'}" class="tab-icon p-2 text-2xl text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2v5m0-7a3 3 0 110-6 3 3 0 010 6zm0-2a1 1 0 011-1h1m-2 0H8a1 1 0 00-1 1v1m0 0H7v1m0 0H6a1 1 0 01-1-1v-1m0 0V8a1 1 0 011-1h1m0 0V6a1 1 0 011-1h1m0 0V4a1 1 0 011-1h1m0 0V2a1 1 0 011-1h1m0 0V1a1 1 0 011-0h1m0 0V0a1 1 0 011-1h1m0 0V-1a1 1 0 011-1h1m0 0V-2a1 1 0 011-1h1m0 0V-3a1 1 0 011-1h1" /><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z" /></svg>
                </button>
                <button @click="activeTab = 'Tasks'" :class="{'active': activeTab === 'Tasks'}" class="tab-icon p-2 text-2xl text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M17 17h.01" /></svg>
                </button>
            </nav>
        </header>

        <main class="relative z-10 p-4 pt-8 md:p-6 md:pt-10 bg-[#fff8f0]">
            
            <section v-if="activeTab === 'Dashboard'" class="space-y-6">
                <h2 class="text-2xl font-semibold text-[#9f583f]">ğŸ”® è³‡é‡‘ç¸½è¦½ (ç•¶å‰å­¸æœŸ)</h2>

                <div class="flex items-center justify-between">
                    <label class="text-lg font-medium text-gray-600">æ™‚é–“é»ï¼š</label>
                    <select v-model="selectedPeriod" class="rounded-lg bg-gray-100 border border-gray-300 p-2 text-[#9f583f]">
                        <option v-for="period in periods" :value="period">{{ period }}</option>
                    </select>
                </div>

                <div class="grid grid-cols-3 gap-3">
                    
                    <div class="light-card bg-[#fff8f0]/70 p-4 text-center border-l-4 border-[#d7a387]">
                        <p class="text-sm text-gray-600">å¾…å…¥å¸³</p>
                        <p class="text-xl md:text-2xl font-bold text-[#d7a387] truncate">NT$ {{ totalPending.toLocaleString() }}</p>
                    </div>
                    
                    <div class="light-card bg-[#f0fff0]/70 p-4 text-center border-l-4 border-green-500">
                        <p class="text-sm text-gray-600">å·²å…¥å¸³</p>
                        <p class="text-xl md:text-2xl font-bold text-green-700 truncate">NT$ {{ totalReceived.toLocaleString() }}</p> 
                    </div>
                    
                    <div class="light-card bg-[#fae9d4]/70 p-4 text-center border-l-4 border-[#9f583f]">
                        <p class="text-sm text-gray-600">ç¸½é è¨ˆ/å·²å…¥å¸³</p>
                        <p class="text-xl md:text-2xl font-bold text-[#9f583f] truncate">NT$ {{ totalAll.toLocaleString() }}</p>
                    </div>
                </div>

                <div class="pt-4 space-y-3">
                    <h3 class="text-xl font-bold text-gray-700 border-b pb-2">ç‹€æ…‹èªªæ˜ (Status Map)</h3>
                    <p class="text-lg font-extrabold text-[#d7a387]">å¾…å…¥å¸³ (Pending) = ç‹€æ…‹ 3. å·²é€ä»¶/å¯©æ ¸ä¸­ | ç‹€æ…‹ 4. éœ€è£œä»¶/é€€ä»¶è­¦ç¤º</p>
                    <p class="text-lg font-extrabold text-green-700">å·²å…¥å¸³ (Received) = ç‹€æ…‹ 5. å·²å…¥å¸³/ä»»å‹™å®Œçµ</p>
                    <p class="text-lg font-extrabold text-[#9f583f]">æ½›åœ¨é è¨ˆ (Projected) = ç‹€æ…‹ 1. å¾…åƒåŠ /è¨ˆç•«ä¸­ | ç‹€æ…‹ 2. å·²åƒåŠ /å¾…å¡«è¡¨</p>
                </div>
                </section>
            
            <hr class="my-6 border-gray-200" />

            <section v-if="activeTab === 'Items'" class="space-y-6">
                <h2 class="text-2xl font-semibold text-[#9f583f]">ğŸ“œ æ”¶å…¥/é …ç›®æ¸…å–®</h2>

                <div class="flex space-x-2 overflow-x-auto pb-2">
                    <select v-model="selectedPeriod" class="min-w-[150px] rounded-lg bg-gray-100 border border-gray-300 p-2 text-sm text-gray-700">
                        <option v-for="period in periods" :value="period">{{ period }}</option>
                    </select>

                    <select v-model="selectedStatusFilter" class="min-w-[120px] rounded-lg bg-gray-100 border border-gray-300 p-2 text-sm text-gray-700">
                        <option value="all">å…¨éƒ¨ç‹€æ…‹</option>
                        <option value="pending">å¾…å…¥å¸³ (ç‹€æ…‹ 3, 4)</option>
                        <option value="received">å·²å…¥å¸³ (ç‹€æ…‹ 5)</option>
                        <option value="projected">æ½›åœ¨é è¨ˆ (ç‹€æ…‹ 1, 2)</option>
                    </select>
                    
                    <select v-model="selectedSourceFilter" class="min-w-[120px] rounded-lg bg-gray-100 border border-gray-300 p-2 text-sm text-gray-700">
                           <option value="all">æ‰€æœ‰ä¾†æº</option>
                           <option v-for="source in sources" :value="source.tag">{{ source.tag }}</option>
                    </select>
                </div>

                <div class="space-y-4">
                    <div v-for="item in sortedItems" :key="item.id" 
                             @click="editItem(item)" 
                             :class="{'border-l-4 border-green-500': item.status === 5, 'border-l-4 border-red-500': item.status === 4, 'border-l-4 border-[#d7a387]': item.status <= 3}" 
                             class="light-card bg-white p-4 relative cursor-pointer">
                        
                        <button @click.stop="deleteItem(item.id)" class="absolute top-2 right-2 text-gray-300 hover:text-red-500 transition duration-150 p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                        
                        <div class="flex justify-between pr-8">
                            <p class="text-lg font-medium">{{ item.name }}</p>
                            <span :class="{'text-green-700': item.status === 5, 'text-red-700': item.status === 4, 'text-[#9f583f]': item.status <= 3}" class="text-xl font-bold">NT$ {{ item.amount.toLocaleString() }}</span>
                        </div>
                        <p class="text-sm text-gray-500">
                             ä¾†æº: **{{ item.source }}** | 
                             åœ°é»: **{{ item.location || 'æœªå®š' }}** | 
                             åƒåŠ /å®Œæˆæ—¥æœŸ: **{{ item.completionDate || 'æœªå®š' }}**
                        </p>
                        <div class="mt-2 flex items-center justify-between text-sm">
                            <span :class="{'bg-green-500 text-white': item.status === 5, 'bg-red-500 text-white': item.status === 4, 'bg-[#d7a387] text-white': item.status <= 3}" class="rounded-full px-3 py-1 text-xs">ç‹€æ…‹: {{ item.status }}. {{ item.statusText }}</span>
                            <span v-if="item.remarks" class="text-red-600 font-bold ml-3">ã€å·²å‚™è¨»ã€</span>
                        </div>
                    </div>

                    <p v-if="sortedItems.length === 0" class="text-center text-gray-400 pt-8">
                        æ²’æœ‰ç¬¦åˆç•¶å‰ç¯©é¸æ¢ä»¶çš„æ”¶å…¥é …ç›®ã€‚
                    </p>
                </div>

                <button @click="showModal = true; editingItem = null; resetItemForm();" class="fixed bottom-4 right-6 z-30 flex h-14 w-14 items-center justify-center rounded-full bg-[#9f583f] text-3xl font-bold text-white shadow-lg shadow-[#9f583f]/50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
            </section>
            
            <hr class="my-6 border-gray-200" />

            <section v-if="activeTab === 'Tasks'" class="space-y-4">
                <h2 class="text-2xl font-semibold text-[#9f583f]">ğŸ“‹ å¾…è¾¦ä»»å‹™æ¸…å–®</h2>
                <div class="space-y-3">
                    <div v-for="task in sortedIncompleteTasks" :key="task.id" 
                             @click="editTask(task)"
                             :class="{'border-l-4 border-red-500': task.alert, 'border-l-4 border-[#d7a387]': !task.alert}" 
                             class="light-card flex items-start space-x-3 bg-white p-4 cursor-pointer">
                        
                        <div class="flex-grow">
                            <p :class="{'text-red-600': task.alert, 'text-[#9f583f]': !task.alert}" class="font-medium">
                                 {{ task.name }}
                            </p>
                            <p class="text-xs text-gray-500">
                                 ä¾†è‡ª: **{{ task.source }}** | 
                                 åœ°é»: **{{ task.location || 'æœªå®š' }}** | 
                                 <span :class="{'font-bold text-red-500': task.alert}">æœŸé™: **{{ task.dueDate }}**</span>
                            </p>
                            <div class="mt-1">
                                <span v-if="task.remarks" class="text-red-600 font-bold text-xs">ã€å·²å‚™è¨»ã€</span>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="sortedCompletedTasks.length > 0" class="pt-4 border-t border-dashed border-gray-300 mt-4">
                        <h3 class="text-lg font-semibold text-green-600 mb-3">âœ… å·²å®Œæˆä»»å‹™</h3>
                        <div v-for="task in sortedCompletedTasks" :key="task.id" 
                                 @click="editTask(task)"
                                 class="light-card flex items-start space-x-3 bg-green-50/70 p-4 cursor-pointer border-l-4 border-green-500 opacity-70">
                            
                            <div class="flex-grow">
                                <p class="font-medium line-through text-green-700">
                                         {{ task.name }}
                                </p>
                                <p class="text-xs text-gray-500">
                                         ä¾†è‡ª: **{{ task.source }}** | 
                                         åœ°é»: **{{ task.location || 'æœªå®š' }}** | 
                                         <span class="font-bold">å®Œæˆæ—¥: **{{ task.completionDate || 'N/A' }}**</span>
                                </p>
                                <div class="mt-1">
                                    <span class="bg-green-100 text-green-700 rounded-full px-2 py-0.5 text-xs font-bold">ä»»å‹™å·²å®Œæˆ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p v-if="tasks.length === 0" class="text-center text-gray-400 pt-8">
                        ç›®å‰æ²’æœ‰å¾…è¾¦ä»»å‹™ã€‚
                    </p>
                </div>

                <button @click="showTaskModal = true; resetTaskForm();" class="fixed bottom-4 right-6 z-30 flex h-14 w-14 items-center justify-center rounded-full bg-red-500 text-3xl font-bold text-white shadow-lg shadow-red-500/50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
            </section>
        </main>

        <div v-if="showModal" class="fixed inset-0 z-40 flex items-center justify-center modal-overlay">
            <div class="light-card bg-white p-6 w-11/12 max-w-md overflow-y-auto max-h-screen">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-[#9f583f]">{{ editingItem ? 'ç·¨è¼¯æ”¶å…¥é …ç›®' : 'æ–°å¢æ”¶å…¥é …ç›®' }}</h3>
                    <button @click="showModal = false" class="text-gray-500 hover:text-gray-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <input type="text" placeholder="é …ç›®åç¨±" v-model="currentEditedItem.name" class="w-full p-2 border border-gray-300 rounded-md">
                    <input type="number" placeholder="é‡‘é¡ (NT$)" v-model.number="currentEditedItem.amount" class="w-full p-2 border border-gray-300 rounded-md">
                    
                    <select v-model.number="currentEditedItem.status" class="w-full p-2 border border-gray-300 rounded-md">
                        <option :value="1">1. å¾…åƒåŠ  / è¨ˆç•«ä¸­ (æ½›åœ¨é è¨ˆ)</option>
                        <option :value="2">2. å·²åƒåŠ  / å¾…å¡«è¡¨ (æ½›åœ¨é è¨ˆ)</option>
                        <option :value="3">3. å·²é€ä»¶ / å¯©æ ¸ä¸­ (å¾…å…¥å¸³)</option>
                        <option :value="4">4. éœ€è£œä»¶ / é€€ä»¶è­¦ç¤º (å¾…å…¥å¸³)</option>
                        <option :value="5">5. å·²å…¥å¸³ / ä»»å‹™å®Œçµ (å·²å…¥å¸³)</option>
                    </select>

                    <select v-model="currentEditedItem.source" class="w-full p-2 border border-gray-300 rounded-md">
                        <option v-for="source in sources" :value="source.tag">{{ source.tag }}</option>
                    </select>

                    <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">å…¥å¸³/å®Œæˆæ—¥æœŸ (æœƒç”¨æ–¼åˆ—è¡¨æ’åº)</label>
                           <input type="date" v-model="currentEditedItem.completionDate" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>

                    <input type="text" placeholder="æ•™å®¤/åœ°é» (é¸å¡«)" v-model="currentEditedItem.location" class="w-full p-2 border border-gray-300 rounded-md">

                    <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">å‚™è¨» (é¸å¡«)</label>
                           <textarea placeholder="è©³ç´°å‚™è¨»å…§å®¹ (åªæœ‰é»é€²ç·¨è¼¯æ‰æœƒé¡¯ç¤º)" v-model="currentEditedItem.remarks" rows="3" class="w-full p-2 border border-gray-300 rounded-md"></textarea>
                    </div>


                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ‰€å±¬å­¸æœŸ (å¯å¤šé¸)</label>
                        <div class="flex flex-wrap gap-2">
                             <label v-for="period in periods" class="inline-flex items-center">
                                 <input type="checkbox" :value="period" v-model="currentEditedItem.period" class="form-checkbox text-[#9f583f] rounded">
                                 <span class="ml-2 text-sm text-gray-700">{{ period }}</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="mt-6 flex justify-end">
                    <button @click="deleteItem(currentEditedItem.id); showModal = false;" v-if="editingItem" class="bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600 mr-auto">
                           åˆªé™¤é …ç›®
                    </button>
                    <button @click="showModal = false" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 mr-2">å–æ¶ˆ</button>
                    <button @click="saveItem" class="bg-[#9f583f] text-white py-2 px-4 rounded-md hover:bg-[#864c39]">å„²å­˜</button>
                </div>
            </div>
        </div>

        <div v-if="showTaskModal" class="fixed inset-0 z-40 flex items-center justify-center modal-overlay">
            <div class="light-card bg-white p-6 w-11/12 max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-red-600">{{ editingTask ? 'ç·¨è¼¯ä»»å‹™' : 'æ–°å¢å¾…è¾¦ä»»å‹™' }}</h3>
                    <button @click="showTaskModal = false" class="text-gray-500 hover:text-gray-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <input type="text" placeholder="ä»»å‹™åç¨±" v-model="currentEditedTask.name" class="w-full p-2 border border-gray-300 rounded-md">
                    <input type="date" placeholder="æˆªæ­¢æ—¥æœŸ (YYYY-MM-DD)" v-model="currentEditedTask.dueDate" class="w-full p-2 border border-gray-300 rounded-md">
                    
                    <select v-model="currentEditedTask.source" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="">é¸æ“‡ç›¸é—œæ”¶å…¥ä¾†æº...</option>
                        <option v-for="source in sources" :value="source.tag">{{ source.tag }}</option>
                    </select>

                    <input type="text" placeholder="æ•™å®¤/åœ°é» (é¸å¡«)" v-model="currentEditedTask.location" class="w-full p-2 border border-gray-300 rounded-md">

                    <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">å‚™è¨» (é¸å¡«)</label>
                           <textarea placeholder="è©³ç´°å‚™è¨»å…§å®¹ (åªæœ‰é»é€²ç·¨è¼¯æ‰æœƒé¡¯ç¤º)" v-model="currentEditedTask.remarks" rows="3" class="w-full p-2 border border-gray-300 rounded-md"></textarea>
                    </div>

                      <label class="inline-flex items-center text-red-600">
                         <input type="checkbox" v-model="currentEditedTask.alert" class="form-checkbox text-red-600 rounded">
                         <span class="ml-2 text-sm">ç·Šæ€¥/éœ€è£œä»¶è­¦ç¤º</span>
                    </label>
                    
                    <label class="inline-flex items-center text-green-600" v-if="editingTask">
                         <input type="checkbox" v-model="currentEditedTask.completed" class="form-checkbox text-green-600 rounded">
                         <span class="ml-2 text-sm">ä»»å‹™å·²å®Œæˆ</span>
                    </label>
                    <div v-if="currentEditedTask.completed" class="mt-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å®Œæˆæ—¥æœŸ</label>
                        <input type="date" v-model="currentEditedTask.completionDate" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    
                </div>

                <div class="mt-6 flex justify-end">
                    <button @click="deleteTask(currentEditedTask.id); showTaskModal = false;" v-if="editingTask" class="bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600 mr-auto">
                           åˆªé™¤ä»»å‹™
                    </button>
                    <button @click="showTaskModal = false" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 mr-2">å–æ¶ˆ</button>
                    <button @click="saveTask" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, watch } = Vue

        const defaultTaskForm = () => ({
            id: null, name: '', dueDate: new Date().toISOString().substring(0, 10), 
            source: '', alert: false, completed: false, remarks: '', location: '', completionDate: ''
        });

        const getStatusText = (status) => {
            const map = { 1: 'å¾…åƒåŠ  / è¨ˆç•«ä¸­', 2: 'å·²åƒåŠ  / å¾…å¡«è¡¨', 3: 'å·²é€ä»¶ / å¯©æ ¸ä¸­', 4: 'éœ€è£œä»¶ / é€€ä»¶è­¦ç¤º', 5: 'å·²å…¥å¸³ / ä»»å‹™å®Œçµ' };
            return map[status] || 'æœªçŸ¥';
        };
        
        const defaultItemForm = (status = 1) => ({ 
            id: null, name: '', amount: 0, status: status, 
            statusText: getStatusText(status), source: 'I. å›ºå®šå·¥è®€', 
            period: ['2025/09-2026/01'], completionDate: '', 
            remarks: '', location: '' 
        });


        createApp({
            setup() {
                const activeTab = ref('Dashboard')
                const showModal = ref(false) 
                const showTaskModal = ref(false) 
                const selectedPeriod = ref('2025/09-2026/01')
                const selectedStatusFilter = ref('all')
                const selectedSourceFilter = ref('all')
                
                const editingItem = ref(null);
                const currentEditedItem = ref(defaultItemForm()); 
                
                const editingTask = ref(null);
                const currentEditedTask = ref(defaultTaskForm()); 

                // --- æ•¸æ“šçµæ§‹ (ä¿æŒä¸è®Š) ---
                const sources = ref([
                    { tag: 'I. å›ºå®šå·¥è®€', category: 'å›ºå®šæ”¶å…¥' },
                    { tag: 'II. è®€æ›¸å¿ƒå¾—', category: 'å­¸ç¿’/å¯«ä½œçå‹µ' },
                    { tag: 'II. è®€æ›¸æœƒ', category: 'å­¸ç¿’/å¯«ä½œçå‹µ' },
                    { tag: 'II. çå‹µé‡‘ (æ ¡å…§)', category: 'å­¸ç¿’/å¯«ä½œçå‹µ' },
                    { tag: 'III. å­¸ä¼´', category: 'æ ¡å…§å°ˆæ¡ˆ/æ´»å‹•' },
                    { tag: 'III. å­¸è¼”ä¸­å¿ƒæ´»å‹•', category: 'æ ¡å…§å°ˆæ¡ˆ/æ´»å‹•' },
                    { tag: 'III. åŸæ°‘ä¸­å¿ƒæ´»å‹•', category: 'æ ¡å…§å°ˆæ¡ˆ/æ´»å‹•' },
                    { tag: 'IV. è­‰ç…§ç­', category: 'å°ˆæ¥­/ç«¶è³½è£œåŠ©' },
                    { tag: 'IV. è­‰ç…§/æ¯”è³½é‡‘', category: 'å°ˆæ¥­/ç«¶è³½è£œåŠ©' },
                    { tag: 'V. æ ¡å¤–çå­¸é‡‘', category: 'æ ¡å¤–çå­¸é‡‘' },
                    { tag: 'VI. å…¶ä»–/é›œé …', category: 'å…¶ä»–' },
                ]);

                const periods = ref([
                    '2025/09-2026/01', 
                    '2026/02-2026/08',
                    '2026/09-2027/01',
                    '2027/02-2027/09'
                ]);
                
                // æ¨¡æ“¬æ”¶å…¥æ•¸æ“š
                const items = ref([
                    { id: 1, name: 'è®€æ›¸å¿ƒå¾—è£œåŠ©é‡‘', amount: 800, status: 5, statusText: getStatusText(5), source: 'II. è®€æ›¸å¿ƒå¾—', period: ['2025/09-2026/01'], completionDate: '2025-12-01', remarks: 'é€™æ¬¡ç”³è«‹æµç¨‹è¼ƒå¿«ï¼Œæ³¨æ„ä¸‹æ¬¡æˆªæ­¢æ—¥æ˜¯2026/01/30ã€‚', location: 'è¡Œæ”¿å¤§æ¨“ 302' },
                    { id: 2, name: 'æ ¡å¤–çå­¸é‡‘', amount: 10000, status: 4, statusText: getStatusText(4), source: 'V. æ ¡å¤–çå­¸é‡‘', period: ['2026/02-2026/08'], completionDate: '2026-03-15', remarks: 'éœ€è£œäº¤æˆ¶ç±è¬„æœ¬æ­£æœ¬ï¼Œæ€¥ä»¶ï¼', location: 'å­¸å‹™è™• 4F' },
                    { id: 3, name: 'å­¸ä¼´è¨ˆç•«è£œåŠ©é‡‘', amount: 3000, status: 2, statusText: getStatusText(2), source: 'III. å­¸ä¼´', period: ['2025/09-2026/01'], completionDate: '2025-10-20', remarks: 'å‚™è¨»æ¸¬è©¦å…§å®¹ï¼Œè«‹ç¢ºèªå ±åäººæ•¸ã€‚', location: 'åœ–æ›¸é¤¨ B1 ç ”è¨å®¤ 3' },
                    { id: 4, name: 'å¹´åº¦å·¥è®€è–ªè³‡', amount: 24000, status: 3, statusText: getStatusText(3), source: 'I. å›ºå®šå·¥è®€', period: ['2025/09-2026/01', '2026/02-2026/08'], completionDate: '2025-12-15', remarks: 'å·²æé†’æœƒè¨ˆéƒ¨ï¼Œé è¨ˆæœˆåº•å‰æ’¥æ¬¾ã€‚', location: 'è¡Œæ”¿å¤§æ¨“ 205 å®¤' },
                ]);
                
                // æ¨¡æ“¬ä»»å‹™æ•¸æ“š
                const tasks = ref([
                    { id: 1, name: 'ç¹³äº¤ï¼šçå­¸é‡‘ç”³è«‹æ›¸', dueDate: '2025-12-10', source: 'V. æ ¡å¤–çå­¸é‡‘', alert: true, completed: false, remarks: 'éœ€é™„ä¸Šè¿‘ä¸€å­¸æœŸæˆç¸¾å–®å½±æœ¬ã€‚è‹¥è¶…éæœŸé™ï¼Œå¿…é ˆå‘ä¸»ä»»ç”³è«‹å»¶æœŸã€‚', location: 'å­¸å‹™è™• 4F', completionDate: '' },
                    { id: 2, name: 'æ’°å¯«ï¼šè®€æ›¸æœƒå¿ƒå¾—å ±å‘Š', dueDate: '2026-01-05', source: 'II. è®€æ›¸æœƒ', alert: false, completed: false, remarks: '', location: 'ç·šä¸Šæœƒè­°å®¤', completionDate: '' },
                    { id: 3, name: 'æ–°å¢æ¸¬è©¦ä»»å‹™(æ˜å¤©)', dueDate: '2025-12-08', source: 'VI. å…¶ä»–/é›œé …', alert: false, completed: true, remarks: 'æ¸¬è©¦å‚™è¨»ï¼Œé‡è¦è³‡è¨Šè«‹åœ¨ç·¨è¼¯æ¬„ä½æŸ¥çœ‹', location: '', completionDate: '2025-12-06' },
                ]);


                // --- Dashboard Computed Properties ---
                const filteredItemsByPeriod = computed(() => {
                    return items.value.filter(item => item.period.includes(selectedPeriod.value));
                });

                const totalPending = computed(() => {
                    return filteredItemsByPeriod.value
                        .filter(item => item.status === 3 || item.status === 4)
                        .reduce((sum, item) => sum + item.amount, 0);
                });

                const totalReceived = computed(() => {
                    return filteredItemsByPeriod.value
                        .filter(item => item.status === 5)
                        .reduce((sum, item) => sum + item.amount, 0);
                });

                // ã€ğŸ¯ ä¿®æ­£é‚è¼¯ã€‘ï¼šé è¨ˆå…¥å¸³ç¸½å’Œ (Total All) = ç‹€æ…‹ 1~5 çš„æ‰€æœ‰é‡‘é¡ç¸½å’Œ
                const totalAll = computed(() => {
                    // è¨ˆç®—æ‰€æœ‰ç‹€æ…‹ (1, 2, 3, 4, 5) çš„é‡‘é¡ç¸½å’Œ
                    return filteredItemsByPeriod.value.reduce((sum, item) => sum + item.amount, 0);
                });

                // ã€èª¿æ•´é‚è¼¯ã€‘ï¼šå°‡åŸæœ¬çš„ totalPotential æ”¹ç‚ºåªè¨ˆç®—ç‹€æ…‹ 1 å’Œ 2 çš„ã€Œæ½›åœ¨é è¨ˆã€
                const totalPotential = computed(() => {
                    return filteredItemsByPeriod.value
                        .filter(item => item.status === 1 || item.status === 2)
                        .reduce((sum, item) => sum + item.amount, 0);
                });


                // --- Items Computed Properties ---
                const sortedItems = computed(() => {
                    let filtered = items.value.filter(item => item.period.includes(selectedPeriod.value));

                    if (selectedStatusFilter.value !== 'all') {
                        filtered = filtered.filter(item => {
                            if (selectedStatusFilter.value === 'pending') return item.status === 3 || item.status === 4;
                            if (selectedStatusFilter.value === 'received') return item.status === 5;
                            if (selectedStatusFilter.value === 'projected') return item.status === 1 || item.status === 2;
                            return true;
                        });
                    }

                    if (selectedSourceFilter.value !== 'all') {
                        filtered = filtered.filter(item => item.source === selectedSourceFilter.value);
                    }

                    // ä¾æ“š completionDate æ’åºï¼Œæ—¥æœŸæœ€æ–°çš„æ’åœ¨æœ€å‰é¢ (é™å†ª)
                    return filtered.sort((a, b) => {
                        const dateA = a.completionDate ? new Date(a.completionDate) : new Date(0); 
                        const dateB = b.completionDate ? new Date(b.completionDate) : new Date(0);
                        return dateB - dateA;
                    });
                });
                
                // --- Tasks Computed Properties ---
                const sortedIncompleteTasks = computed(() => {
                    return tasks.value.filter(t => !t.completed).sort((a, b) => {
                        // 1. Alert (true åœ¨å‰)
                        if (a.alert !== b.alert) return b.alert - a.alert;
                        // 2. Due Date (æ—¥æœŸè¿‘çš„åœ¨å‰)
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    });
                });
                
                const sortedCompletedTasks = computed(() => {
                    return tasks.value.filter(t => t.completed).sort((a, b) => {
                        // ä¾æ“š completionDate æ’åºï¼Œæ—¥æœŸæœ€æ–°çš„æ’åœ¨æœ€å‰é¢ (é™å†ª)
                        const dateA = a.completionDate ? new Date(a.completionDate) : new Date(0);
                        const dateB = b.completionDate ? new Date(b.completionDate) : new Date(0);
                        return dateB - dateA;
                    });
                });
                

                // --- Item Methods (çœç•¥ç´°ç¯€ï¼Œä¿æŒé‚è¼¯ä¸è®Š) ---
                const resetItemForm = () => { currentEditedItem.value = defaultItemForm(); editingItem.value = null; };
                const editItem = (item) => { editingItem.value = item; currentEditedItem.value = JSON.parse(JSON.stringify(item)); showModal.value = true; };

                const saveItem = () => {
                     if (!currentEditedItem.value.name || currentEditedItem.value.amount <= 0) { alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®åç¨±å’Œé‡‘é¡ï¼'); return; }

                    const itemToSave = currentEditedItem.value;
                    itemToSave.statusText = getStatusText(itemToSave.status);
                    
                    if (editingItem.value) {
                        const index = items.value.findIndex(i => i.id === itemToSave.id);
                        if (index !== -1) { items.value[index] = itemToSave; }
                    } else {
                        itemToSave.id = Date.now();
                        items.value.unshift(itemToSave);
                    }
                    showModal.value = false;
                };

                const deleteItem = (id) => { if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ”¶å…¥é …ç›®å—ï¼Ÿ')) { items.value = items.value.filter(i => i.id !== id); } };
                
                // --- Task Methods (çœç•¥ç´°ç¯€ï¼Œä¿æŒé‚è¼¯ä¸è®Š) ---
                const resetTaskForm = () => { currentEditedTask.value = defaultTaskForm(); editingTask.value = null; };
                const editTask = (task) => { editingTask.value = task; currentEditedTask.value = JSON.parse(JSON.stringify(task)); showTaskModal.value = true; };
                
                const saveTask = () => {
                    if (!currentEditedTask.value.name || !currentEditedTask.value.dueDate) { alert('è«‹è¼¸å…¥ä»»å‹™åç¨±å’Œæˆªæ­¢æ—¥æœŸï¼'); return; }

                    const taskToSave = currentEditedTask.value;
                    
                    if (taskToSave.completed && !taskToSave.completionDate) { taskToSave.completionDate = new Date().toISOString().substring(0, 10); } 
                    else if (!taskToSave.completed) { taskToSave.completionDate = ''; }
                    
                    if (editingTask.value) {
                        const index = tasks.value.findIndex(t => t.id === taskToSave.id);
                        if (index !== -1) { tasks.value[index] = taskToSave; }
                    } else {
                        taskToSave.id = Date.now();
                        tasks.value.unshift(taskToSave);
                    }
                    showTaskModal.value = false;
                };

                const deleteTask = (id) => { if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å¾…è¾¦ä»»å‹™å—ï¼Ÿ')) { tasks.value = tasks.value.filter(t => t.id !== id); } };

                // åˆå§‹åŒ–è¨­å®š (é˜²æ­¢ currentEditedItem/Task ç‚ºç©º)
                if (!currentEditedItem.value) resetItemForm();
                if (!currentEditedTask.value) resetTaskForm();


                return {
                    activeTab, showModal, showTaskModal, periods, sources, selectedPeriod, selectedStatusFilter, selectedSourceFilter, items, tasks,
                    // Dashboard Data
                    totalPending, totalReceived, totalAll, totalPotential, // <-- totalAll æ˜¯æ–°çš„ç¸½å’Œ
                    // Items Data
                    sortedItems, editItem, saveItem, deleteItem, editingItem, currentEditedItem, resetItemForm,
                    // Tasks Data
                    sortedIncompleteTasks, sortedCompletedTasks, editTask, saveTask, deleteTask, editingTask, currentEditedTask, resetTaskForm, getStatusText
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
